<!DOCTYPE html>
<html>

<head>
  <title>Spellbound ğ‘•ğ‘ğ‘§ğ‘¤ğ‘šğ‘¬ğ‘¯ğ‘› - Shavian word game</title>
  <meta name="description"
    content="Given a randomly generated set of letters, think of as many long, rare words as you can!">
  <meta property="og:description"
    content="Given a randomly generated set of letters, think of as many long, rare words as you can!">
  <meta name="twitter:description"
    content="Given a randomly generated set of letters, think of as many long, rare words as you can!">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    @font-face {
      font-family: "_font";
      src: url("./shavian-fonts/space-mono-shavian-r.otf");
    }

    @font-face {
      font-family: "_font";
      src: url("./shavian-fonts/space-mono-shavian-b.otf");
      font-weight: bold;
    }

    @media screen {
      :root {
        background: black;
        color: white;
      }
    }

    :root {
      font-family: "_font", "Space Mono", monospace;
      font-smooth: never;
      -webkit-font-smoothing: none;
      /* WebKit MacOS */
      /* Firefox can only choose grayscale vs. ClearType, not turn off antialias altogether */

      --col-dim-bg: rgb(35, 35, 39);
      --col-dim: rgb(108, 108, 120);
      font-size: 16px;
      --col-accent: rgb(240, 192, 33);
    }

    a {
      color: var(--col-accent);
    }

    a:visited {
      color: var(--col-accent);
    }

    input,
    button {
      font-family: inherit;
      font-size: inherit;
      color: inherit;
      background: inherit;
      border: 2px solid var(--col-accent);
    }

    button {
      min-width: 2rem;
      min-height: 2rem;
    }

    body {
      margin: 0;
      padding: 0;
      width: 100vw;
      min-height: 100svh;
      overflow-x: hidden;
    }

    @media screen and (min-width: 480px) {
      body {
        display: grid;
        grid-template-columns: 12rem 1fr;
        grid-template-rows: 2rem 3fr 2fr;
        grid-template-areas:
          "status status"
          "nav game"
          "nav game";
      }

      .page-game {
        grid-area: game;
      }

      nav {
        grid-area: nav;
      }

      #status {
        grid-area: status;
      }

      #keyboardGrid {
        width: 100%;
        max-width: 25rem;
      }
    }

    .full-page {
      z-index: 16;
      position: fixed;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      inset: 0;
      background: rgba(32, 32, 32, 0.5);
      min-height: 0;
    }

    .modal-bg {
      padding: 1rem;
      background: black;
      border: 2px solid var(--col-dim);
      width: 24rem;
      max-width: calc(100vw - 1rem);
      max-height: calc(100svh - 1rem);
      min-height: 0;
      overflow-y: auto;
      overflow-x: hidden;
    }

    #status {
      width: 100%;
      background: var(--col-dim-bg);
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    #startGame,
    #anotherGame {
      text-align: center;
    }

    @media screen and (max-width: 479.999px) {
      body {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
      }

      #keyboard,
      #keyboardGrid {
        width: 100%;
      }
    }

    #title {
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: 32px;
      font-weight: normal;
    }

    h3 {
      font-size: 16px;
      color: var(--col-accent);
      font-weight: normal;
    }

    h3::before {
      content: "â€ºâ€ºâ€º ";
    }

    #grid {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 4px;
      margin-block: 1rem;
    }

    .gridLine {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 4px;
    }

    .gridWord,
    .gridRarity,
    .gridScore,
    .gridCumScore {
      text-align: center;
      line-height: 2rem;
      box-shadow: 2px 2px 0px var(--col-dim);
      background: black;
      color: var(--col-dim);
      height: 2rem;
    }

    .gridWord {
      width: 12rem;
    }

    .gridRarity {
      width: 2rem;
    }

    .gridScore,
    .gridCumScore {
      width: 3rem;
      text-align: right;
    }

    .gridLine.inactive .gridWord,
    .gridLine.inactive .gridRarity,
    .gridLine.inactive .gridScore,
    .gridLine.inactive .gridCumScore {
      background: var(--col-dim-bg);
    }

    #keyboard {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #keyboard input {
      background: black;
      color: white;
      border: 1px solid var(--col-accent);
      font-family: inherit;
      font-size: 1.5rem;
      width: 100%;
      max-width: 20rem;
      text-align: center;
      margin: 0 auto;
    }

    #keyboardGrid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
    }

    #keyboardGrid button {
      min-width: 2rem;
      height: 3rem;
      font-family: inherit;
      font-size: 2rem;
      background: black;
      color: white;
      border: 1px solid var(--col-dim);
      position: relative;
      overflow: hidden;
    }

    #keyboardGrid button .buttonLabel {
      position: absolute;
      inset: 0;
      height: 3rem;
      line-height: 3rem;
      font-size: 2rem;
      transform: translateY(-0.25rem);
    }

    #screenBottomWordListBox {
      max-height: 8rem;
      overflow-y: scroll;
    }

    #sound {
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
  </style>
  <script>
    const MIN_CHARS = 3;
    const MAX_GUESSES = 5;

    let soundOn = false;
    function soundToggled(event) {
      if (event) {
        soundOn = event.target.checked;
      } else {
        document.getElementById("toggleSound").checked = false;
      }
      if (soundOn) {
        document.getElementById("sound_dummy").play();
      } else {
        document.getElementById("sound_dummy").pause();
      }
    }

    function playSound(id) {
      if (!soundOn) return;
      const player = document.getElementById("sound_" + id);
      if (player.paused) {
        player.play();
      } else {
        player.currentTime = 0;
      }
    }

    function freqToBonus(rarity) {
      return (
        0 + (
          rarity <= 100
        ) + (
          rarity <= 50
        ) + (
          rarity <= 25
        ) + (
          rarity <= 10
        ) + (
          rarity == 0
        )
      );
    }
    const constructWord = (latin, shavian, frequency) => [
      latin,
      shavian,
      [...shavian].length * 2 + freqToBonus(frequency),
      frequency
    ];
    const wordLatin = (x) => x[0];
    const wordShavian = (x) => x[1];
    const wordScore = (x) => x[2];
    const wordFrequency = (x) => x[3];
    const wordFreqBonus = (x) => freqToBonus(x[3]);

    function mulberry32(a) {
      return function () {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      }
    }
    const prng = mulberry32(Date.now());
    function randRange(vMax) {
      return Math.floor(prng() * vMax);
    }

    let blockingInput = false;

    let input; // document.getElementById("textInput");

    let guesses = [];
    let score = 0;
    let maxScore = 0;
    let par = 0;
    let achievement = 0;
    let rating = "";
    const clamp = (a) => Math.min(1, Math.max(a, 0));
    const invLerp = (lo, hi, a) => clamp((a - lo) / (hi - lo));
    function calculateRating() {
      achievement = invLerp(0, par, score) + invLerp(par, maxScore, score);
      if (achievement == 2) {
        rating = "â˜…";
      } else if (achievement >= 1) {
        rating = "S";
      } else if (achievement >= 0.8) {
        rating = "A";
      } else if (achievement >= 0.6) {
        rating = "B";
      } else if (achievement >= 0.3) {
        rating = "C";
      } else {
        rating = "D";
      }
    }


    let keys = [];
    let charMap = [..."ğ‘ğ‘‘ğ‘’ğ‘“ğ‘”ğ‘•ğ‘–ğ‘—ğ‘˜ğ‘™ğ‘šğ‘›ğ‘œğ‘ğ‘ğ‘Ÿğ‘ ğ‘¡ğ‘¢ğ‘£ğ‘¤ğ‘¥ğ‘¦ğ‘§ğ‘¨ğ‘©ğ‘ªğ‘«ğ‘¬ğ‘­ğ‘®ğ‘¯ğ‘°ğ‘±ğ‘²ğ‘³ğ‘´ğ‘µğ‘¶ğ‘·ğ‘¸ğ‘¹ğ‘ºğ‘»ğ‘¼ğ‘½ğ‘¾ğ‘¿"];
    let soundMap = [
      "p", "t", "k", "f", "th", "s", "sh", "ch", "y", "ng", "b", "d", "g", "v", "dh", "z", "zh", "jh", "w", "h", "l", "m", "ih", "eh", "ae", "ax", "ao", "uh", "aw", "aa", "r", "n", "iy", "ey", "ay", "ah", "ow", "uw", "oy", "au", "ar", "or", "er", "yr", "rr", "ir", "ia", "yu",
    ];

    // swear words should not be asked
    const censored_words = [
      "bitched",
      "bitches",
      "bitching",
      "fifi",
      "fucked",
      "fucking",
      "fucks",
      "pissed",
      "pissing",
      "shits",
      "shithead",
      "shitting",
    ];

    // if I find unsuitable words, I add them here
    const banned_words = ["cm", "colonnade", "divan", "overawed"];

    let wordList = [];
    let solutions = [];

    function setStatus(status) {
      const el = document.getElementById("statusText");
      if (el) {
        el.innerHTML = status;
      } else {
        console.log("setStatus: " + status);
      }
    }

    function getDict(handler) {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open(
        "GET",
        "https://2gd4.me/tidbit/readlex_spellbound.json",
        true
      );
      xmlHttp.send(null);
      xmlHttp.onload = () => {
        if (xmlHttp.readyState === xmlHttp.DONE) {
          console.log("xmlHttp loaded");
          handler(xmlHttp.responseText.trim());
        }
      };
    }

    function initDict(callback) {
      const lastDictUpdate =  "" + (+new Date(2024, 1, 3));
      let dictAge = +localStorage.getItem("dictAge");
      const savedDict = JSON.parse(localStorage.getItem("dict"));
      console.log(
        "dict test:",
        lastDictUpdate,
        dictAge,
        savedDict ? savedDict.length : -1
      );
      // TEST: force invalidate cache
      //dictAge = 0;
      if (
        dictAge == null ||
        dictAge != lastDictUpdate ||
        savedDict.length <= 0
      ) {
        setStatus("Downloading dictionary... (This may take a while, but it will only happen once.)");
        // set a timeout so I can actually show the status
        setTimeout(() => {
          getDict((dict) => {
            if (dict.startsWith("<!DOCTYPE html>")) {
              // failed with 404
              setStatus("Could not load dictionary.");
              return;
            }
            const parsed = JSON.parse(dict);
            wordList = parsed;
            localStorage.setItem("dictAge", lastDictUpdate);
            localStorage.setItem("dict", dict);
            console.log(wordList);
            setStatus(
              `Loaded dictionary! Word count: ${wordList.length}`
            );
            callback();
          });
        }, 1);
      } else {
        wordList = savedDict;
        console.log(wordList);
        setStatus(
          `Loaded dictionary! Word count: ${wordList.length}`
        );
        callback();
      }
    }

    function generateGame() {
      guesses = [];
      score = 0;
      document.querySelectorAll(".gridWord, .gridRarity, .gridScore, .gridCumScore").forEach(el => {
        el.innerText = "";
      })
      // pick 6 letters that aren't ğ‘¦ ğ‘© ğ‘¼
      const CONSONANTS = [..."ğ‘ğ‘‘ğ‘’ğ‘“ğ‘”ğ‘•ğ‘–ğ‘—ğ‘˜ğ‘™ğ‘šğ‘›ğ‘œğ‘ğ‘ğ‘Ÿğ‘ ğ‘¡ğ‘¢ğ‘£ğ‘¤ğ‘¥ğ‘®ğ‘¯"];
      const VOWELS_1 = [..."ğ‘§ğ‘¨ğ‘ªğ‘«ğ‘¬ğ‘­ğ‘°ğ‘±ğ‘²ğ‘³ğ‘´ğ‘µğ‘¶ğ‘·"]
      const VOWELS_2 = [..."ğ‘¸ğ‘¹ğ‘ºğ‘»ğ‘½ğ‘¾ğ‘¿"];
      keys = [];

      for (let i = 0; i < 5; i++) {
        const j = randRange(CONSONANTS.length);
        keys.push(CONSONANTS[j]);
        CONSONANTS.splice(j, 1);
      }
      for (let i = 0; i < 3; i++) {
        const j = randRange(VOWELS_1.length);
        keys.push(VOWELS_1[j]);
        VOWELS_1.splice(j, 1);
      }
      const j = randRange(VOWELS_2.length);
      keys.push(VOWELS_2[j]);
      VOWELS_2.splice(j, 1);
      keys.push("ğ‘¦", "ğ‘©", "ğ‘¼");
      console.log(keys);
      const keyElements = document.querySelectorAll(
        "#keyboardGrid > button:not(.buttonFunction)"
      );
      for (let i = 0; i < 12; i++) {
        keyElements[i].querySelector(".buttonLabel").innerText = keys[i];
      }
      console.log("wordList is", wordList);
      // find the possible answers
      solutions = [];
      for (let i = 0; i < wordList.length; i++) {
        const letters = [...wordShavian(wordList[i])];
        if (letters.every((thisLetter) => { return keys.includes(thisLetter) })) {
          solutions.push(wordList[i]);
        }
      }
      // sort by score
      solutions.sort((a, b) => wordScore(b) - wordScore(a));
      console.log(solutions);
      // calculate max score
      maxScore = 0;
      let maxCounter = MAX_GUESSES;
      par = 0;
      let parCounter = MAX_GUESSES;
      for (let i = 0; i < solutions.length; i++) {
        if (maxCounter > 0) {
          maxCounter--;
          maxScore += wordScore(solutions[i]);
        }
        if (parCounter > 0 && wordFreqBonus(solutions[i]) <= 2) {
          par += wordScore(solutions[i]);
          parCounter--;
        }
        if (!maxCounter && !parCounter) break;
      }
      if (par > maxScore * 0.6) {
        par = Math.floor(maxScore * 0.6);
      }
      calculateRating();
      document.querySelector("#grid .wordCount").innerText = solutions.length;
      document.querySelector("#grid .scoreBenchmarks").innerText = `par ${par}; max ${maxScore}`
      document.querySelector("#grid .liveRank").innerText = rating;
    }

    function onVirtualButtonClick(event) {
      if (blockingInput) return;
      console.log("clicked button", event.currentTarget.dataset.button);
      let val = [...input.value];
      let cursorStart = [...input.value.substring(0, input.selectionStart)]
        .length;
      let cursorEnd = [...input.value.substring(0, input.selectionEnd)]
        .length;
      // console.log(cursorStart, cursorEnd);
      if (event.currentTarget.dataset.button == "delete") {
        if (cursorStart == cursorEnd) {
          val.splice(cursorStart - 1, 1);
        } else {
          val.splice(cursorStart, cursorEnd - cursorStart);
        }
        input.value = val.join("");
        input.selectionStart = val.slice(0, cursorStart - 1).join().length;
        playSound("delete");
      } else if (event.currentTarget.dataset.button == "giveup") {
        playSound("click");
        if (window.confirm("Are you sure you want to give up?")) {
          playSound("lose");
          onGameOver();
        }
        return
      } else if (event.currentTarget.dataset.button == "submit") {
        playSound("click");
        submitWord(val);
      } else {
        console.log("Entering", keys[event.currentTarget.dataset.button]);
        val.splice(
          cursorStart,
          cursorEnd - cursorStart,
          keys[event.currentTarget.dataset.button]
        );
        input.value = val.join("");
        input.selectionStart = val.slice(0, cursorStart + 1).join().length;
        playSound(soundMap[charMap.indexOf(
          keys[event.currentTarget.dataset.button]
        )]);
      }
    }

    function submitWord(chars) {
      if (blockingInput) return;
      if (chars.length < MIN_CHARS) {
        setStatus("Please enter more characters.");
        return;
      }
      const guess = chars.join("");
      if (guesses.includes(guess)) {
        setStatus("Youâ€™ve already guessed that word.");
        return;
      }
      // search for word
      for (let i = 0; i < solutions.length; i++) {
        if (wordShavian(solutions[i]) == guess) {
          setStatus(
            `Â«${guess}Â» (${wordLatin(solutions[i])}) is worth ${wordScore(solutions[i])} points! (${wordFreqBonus(solutions[i])} rarity bonus)`
          );
          score += wordScore(solutions[i]);
          advanceRow(solutions[i]);
          guesses.push(guess);
          input.value = "";
          if (wordScore(solutions[i]) <= 5) {
            playSound("miss");
          } else if (wordScore(solutions[i]) <= 7) {
            playSound("graze");
          } else {
            playSound("hit");
          }
          calculateRating();
          document.querySelector("#grid .liveRank").innerText = rating;
          return;
        }
      }
      setStatus(`Â«${guess}Â» is not a valid guess.`);
    }

    function advanceRow(guessObj) {
      blockingInput = true;
      const gridLinesEl = document.querySelectorAll("#grid .gridLine");
      const thisLineEl = gridLinesEl[guesses.length];
      thisLineEl.querySelector(".gridWord").innerText = wordShavian(guessObj);
      thisLineEl.querySelector(".gridRarity").innerText = wordFreqBonus(guessObj);
      thisLineEl.querySelector(".gridScore").innerText = wordScore(guessObj);
      thisLineEl.querySelector(".gridCumScore").innerText = score;
      thisLineEl.classList.add("inactive");
      if (guesses.length + 1 < MAX_GUESSES) {
        gridLinesEl[guesses.length + 1].classList.remove("inactive");
        blockingInput = false;
      } else {
        setTimeout(() => {
          playSound("win");
          onGameOver();
        }, 1000);
      }
    }

    function onGameOver() {
      document.getElementById("gameOverScore").innerText = score;
      document.querySelector("#screenBottomSummary .bottomScore").innerText = score;
      document.getElementById("gameOverRating").innerText = `Rank ${rating} (${Math.floor(achievement * 100)}% achievement)`;
      document.querySelector("#screenBottomSummary .bottomRating").innerText = rating;
      document.querySelector("#screenBottomSummary .bottomAchievement").innerText = `${Math.floor(achievement * 100)}`;
      document.getElementById("gameOverMaxScore").innerText = maxScore;
      document.querySelector("#screenBottomSummary .bottomMax").innerText = document.getElementById("gameOverMaxScore").innerText;
      document.getElementById("gameOverParScore").innerText = par;
      document.querySelector("#screenBottomSummary .bottomPar").innerText = document.getElementById("gameOverParScore").innerText;
      document.getElementById("gameOverWordList").replaceChildren([]);
      
      for (let i = 0; i < solutions.length; i++) {
        const el = document.createElement("li");
        el.innerHTML = `<b>${wordShavian(solutions[i])}</b> (${wordLatin(solutions[i])}) [+${wordFreqBonus(solutions[i])}] ${wordScore(solutions[i])} points`;
        document.getElementById("gameOverWordList").appendChild(el);
        blockingInput = false;
      }
      const listCopy = Array.from(
        document.getElementById("gameOverWordList").children,
        v => { return v.cloneNode(true); }
      );
      console.log("listCopy", listCopy);
      document.getElementById("screenBottomWordListBox").querySelector("ul").replaceChildren(...listCopy);
      document.getElementById("keyboard").style.display = "none";
      document.getElementById("anotherGame").style.display = "";
      document.getElementById("gameOver").style.display = "";
    }

    function onGameStartButtonClick(event) {
      if (blockingInput) return;
      blockingInput = true;
      playSound("click");
      document.querySelector("#titleScreen").style.display = "none";
      document.getElementById("anotherGame").style.display = "none";
      setStatus("Loading...");

      initDict(() => {
        generateGame();

        document.getElementById("keyboard").style.display = "";

        document.querySelector("#textInput").value = "";

        document.querySelector("#gameScreen").style.display = "";
        blockingInput = false;
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      input = document.getElementById("textInput");
      for (const el of document.querySelectorAll("#keyboardGrid button")) {
        el.addEventListener("click", onVirtualButtonClick);
      }
      input.addEventListener("keyup", (event) => {
        if (event.key == "Enter") {
          console.log("Enter is pressed");
          submitWord(input.value);
        }
      });
      input.addEventListener("input", (event) => {
        receiveInput(event);
      });
      for (const el of document.querySelectorAll("#startGame button, #anotherGame button")) {
        el.addEventListener("click", onGameStartButtonClick);
      }
      document
        .getElementById("toggleSound")
        .addEventListener("change", soundToggled);
      soundToggled();
      setStatus("Welcome to Spellbound!");
    });

    function onNavLinkClick(event) {
      playSound("click");
      document.querySelector(event.currentTarget.hash).style.display = "";
    }

    function onCloseLinkClick(event) {
      playSound("delete");
      document.querySelector(event.currentTarget.hash).style.display = "none";
    }
  </script>
</head>

<body style="background: black; color: white">
  <div id="sound">
    <audio id="sound_p" src="./shavian-info/p.wav"></audio>
    <audio id="sound_t" src="./shavian-info/t.wav"></audio>
    <audio id="sound_k" src="./shavian-info/k.wav"></audio>
    <audio id="sound_f" src="./shavian-info/f.wav"></audio>
    <audio id="sound_th" src="./shavian-info/th.wav"></audio>
    <audio id="sound_s" src="./shavian-info/s.wav"></audio>
    <audio id="sound_sh" src="./shavian-info/sh.wav"></audio>
    <audio id="sound_ch" src="./shavian-info/ch.wav"></audio>
    <audio id="sound_y" src="./shavian-info/y.wav"></audio>
    <audio id="sound_ng" src="./shavian-info/ng.wav"></audio>
    <audio id="sound_b" src="./shavian-info/b.wav"></audio>
    <audio id="sound_d" src="./shavian-info/d.wav"></audio>
    <audio id="sound_g" src="./shavian-info/g.wav"></audio>
    <audio id="sound_v" src="./shavian-info/v.wav"></audio>
    <audio id="sound_dh" src="./shavian-info/dh.wav"></audio>
    <audio id="sound_z" src="./shavian-info/z.wav"></audio>
    <audio id="sound_zh" src="./shavian-info/zh.wav"></audio>
    <audio id="sound_jh" src="./shavian-info/jh.wav"></audio>
    <audio id="sound_w" src="./shavian-info/w.wav"></audio>
    <audio id="sound_h" src="./shavian-info/h.wav"></audio>
    <audio id="sound_l" src="./shavian-info/l.wav"></audio>
    <audio id="sound_m" src="./shavian-info/m.wav"></audio>
    <audio id="sound_ih" src="./shavian-info/ih.wav"></audio>
    <audio id="sound_eh" src="./shavian-info/eh.wav"></audio>
    <audio id="sound_ae" src="./shavian-info/ae.wav"></audio>
    <audio id="sound_ax" src="./shavian-info/ax.wav"></audio>
    <audio id="sound_ao" src="./shavian-info/ao.wav"></audio>
    <audio id="sound_uh" src="./shavian-info/uh.wav"></audio>
    <audio id="sound_aw" src="./shavian-info/aw.wav"></audio>
    <audio id="sound_aa" src="./shavian-info/aa.wav"></audio>
    <audio id="sound_r" src="./shavian-info/r.wav"></audio>
    <audio id="sound_n" src="./shavian-info/n.wav"></audio>
    <audio id="sound_iy" src="./shavian-info/iy.wav"></audio>
    <audio id="sound_ey" src="./shavian-info/ey.wav"></audio>
    <audio id="sound_ay" src="./shavian-info/ay.wav"></audio>
    <audio id="sound_ah" src="./shavian-info/ah.wav"></audio>
    <audio id="sound_ow" src="./shavian-info/ow.wav"></audio>
    <audio id="sound_uw" src="./shavian-info/uw.wav"></audio>
    <audio id="sound_oy" src="./shavian-info/oy.wav"></audio>
    <audio id="sound_au" src="./shavian-info/au.wav"></audio>
    <audio id="sound_ar" src="./shavian-info/ar.wav"></audio>
    <audio id="sound_or" src="./shavian-info/or.wav"></audio>
    <audio id="sound_er" src="./shavian-info/er.wav"></audio>
    <audio id="sound_yr" src="./shavian-info/yr.wav"></audio>
    <audio id="sound_rr" src="./shavian-info/rr.wav"></audio>
    <audio id="sound_ir" src="./shavian-info/ir.wav"></audio>
    <audio id="sound_ia" src="./shavian-info/ia.wav"></audio>
    <audio id="sound_yu" src="./shavian-info/yu.wav"></audio>
    <audio id="sound_click" src="./shingo_click.wav"></audio>
    <audio id="sound_delete" src="./shingo_delete.wav"></audio>
    <audio id="sound_hit" src="./shingo_hit.wav"></audio>
    <audio id="sound_graze" src="./shingo_graze.wav"></audio>
    <audio id="sound_miss" src="./shingo_miss.wav"></audio>
    <audio id="sound_win" src="./shingo_win.wav"></audio>
    <audio id="sound_lose" src="./shingo_lose.wav"></audio>
    <audio id="sound_dummy" src="./dummy.mp3" loop></audio>
  </div>
  <nav>
    <ul>
      <li>
        <input type="checkbox" id="toggleSound" /><label for="toggleSound">Sound</label>
      </li>
      <li><a href="#rules" onclick="onNavLinkClick(event)">Rules</a></li>
      <li><a href="#credits" onclick="onNavLinkClick(event)">Credits</a></li>
      <li><a href="https://discord.gg/xzrbvJ86fB">Shavian Game Room Discord</a></li>
    </ul>
  </nav>
  <div id="status"><span id="statusText">...</span></div>
  <div id="titleScreen" class="page-game">
    <div id="title">
      <h1>ğ‘•ğ‘ğ‘§ğ‘¤ğ‘šğ‘¬ğ‘¯ğ‘›</h1>
    </div>
    <div id="startGame">
      <button type="button">Start</button>
    </div>
  </div>
  <div id="gameScreen" class="page-game" style="display: none">
    <div id="grid">
      <div class="gridScores">
        <div class="gridScoreBar"><span class="wordCount">0</span> possible words<br><span class="scoreBenchmarks">par 0, max 0</span>; Rank <span class="liveRank"></span></div>
      </div>
      <div class="gridLine">
        <div class="gridWord"></div>
        <div class="gridRarity"></div>
        <div class="gridScore"></div>
        <div class="gridCumScore" style="opacity: 0;"></div>
      </div>
      <div class="gridLine inactive">
        <div class="gridWord"></div>
        <div class="gridRarity"></div>
        <div class="gridScore"></div>
        <div class="gridCumScore"></div>
      </div>
      <div class="gridLine inactive">
        <div class="gridWord"></div>
        <div class="gridRarity"></div>
        <div class="gridScore"></div>
        <div class="gridCumScore"></div>
      </div>
      <div class="gridLine inactive">
        <div class="gridWord"></div>
        <div class="gridRarity"></div>
        <div class="gridScore"></div>
        <div class="gridCumScore"></div>
      </div>
      <div class="gridLine inactive">
        <div class="gridWord"></div>
        <div class="gridRarity"></div>
        <div class="gridScore"></div>
        <div class="gridCumScore"></div>
      </div>
    </div>
    <div id="keyboard" class="page-bottom">
      <p>Enter the longest, rarest word you can think of:</p>
      <input id="textInput" />
      <div id="keyboardGrid">
        <button type="button" data-button="0">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="1">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="2">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="3">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" class="buttonFunction" data-button="delete">âŒ«</button>

        <button type="button" data-button="4">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="5">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="6">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="7">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" class="buttonFunction" data-button="giveup"><svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24" style="max-width: 100%;max-height: 100%;">
            <title>human-handsup</title>
            <path fill="currentColor"
              d="M5,1C5,3.7 6.56,6.16 9,7.32V22H11V15H13V22H15V7.31C17.44,6.16 19,3.7 19,1H17A5,5 0 0,1 12,6A5,5 0 0,1 7,1M12,1C10.89,1 10,1.89 10,3C10,4.11 10.89,5 12,5C13.11,5 14,4.11 14,3C14,1.89 13.11,1 12,1Z" />
          </svg></button>

        <button type="button" data-button="8">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="9">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="10">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" data-button="11">
          <div class="buttonLabel">ğ‘</div>
        </button>
        <button type="button" class="buttonFunction" data-button="submit">âœ”</button>
      </div>
    </div>
    <div id="anotherGame">
      <table id="screenBottomSummary" style="width:100%;max-width:20rem;table-layout: fixed;">
        <tbody>
          <tr>
            <td>Score: <b class="bottomScore">0</b></td>
            <td>Par: <b class="bottomPar">0</b></td>
            <td>Max: <b class="bottomMax">0</b></td>
          </tr>
          <tr>
            <td colspan="2" style="font-size:150%;">Rank: <b class="bottomRating">D</b></td>
            <td>Achievement: <b class="bottomAchievement">0</b>%</td>
          </tr>
        </tbody>
      </table>
      <div id="screenBottomWordListBox">
        <ul></ul>
      </div>
      <p>Play another game?</p>
      <button type="button">Start</button>
    </div>
  </div>
  <div id="rules" class="full-page" style="display: none">
    <div class="modal-bg">
      <h1>Rules</h1>
      <h3>Gameplay</h3>
      <p>You are randomly given a set of 12 letters: 5 random consonants, 4 random vowels, and 3 guaranteed letters: ğ‘¦,
        ğ‘©, and ğ‘¼.</p>
      <p>Your task is to think of as many long, rare words that only contain those 12 letters as you can!</p>
      <h3>Scoring</h3>
      <p><b>Score:</b> Your first 5 <i>valid</i> guesses are scored. You can submit as many invalid words as you want,
        and they wonâ€™t affect
        your score.</p>
      <p><b>Rarity bonus:</b> Your score is 2 Ã— the number of characters your word contains, plus a bonus of up to 5 points
        depending on how rare it is (Cutoffs are a frequency at or under 100, 50, 25, 10, and 0).</p>
      <p><b>Par:</b> The par is the maximum possible score only using words with a frequency bonus of 2 or below, or 60% of
        the maximum possible score, whichever is lower.</p>
      <p><b>Rank:</b> Your score is graded on a curve based on the par and max score, and given a letter grade.</p>
      <ul>
        <li>Max score: â˜… rank</li>
        <li>Par score or above: S rank</li>
        <li>80% par score or above: A rank</li>
        <li>60% par score or above: B rank</li>
        <li>40% par score or above: C rank</li>
        <li>lower: D rank</li>
      </ul>
      <h3>Word inclusion criteria</h3>
      <p>Valid answers are any word that is at least 3 letters long, is not a proper noun, and is not spelled using an
        apostrophe, hyphen, or a space. The words have been taken from <a
          href="https://github.com/Shavian-info/readlex">the Read Lexicon</a>.</p>
      <a href="#rules" onclick="onCloseLinkClick(event)">dismiss</a>
    </div>
  </div>
  <div id="gameOver" class="full-page" style="display: none">
    <div class="modal-bg">
      <h1>Game over!</h1>
      <h3>Your score</h3>
      <ul id="performance">
        <li>Max score: <b id="gameOverMaxScore">0</b></li>
        <li>Par score: <b id="gameOverParScore">0</b></li>
        <li>Your score: <b id="gameOverScore">0</b></li>
        <li>Your rank: <b id="gameOverRating">D</b></li>
        <h3>All possible words</h3>
        <ul id="gameOverWordList"></ul>
        <a href="#gameOver" onclick="onCloseLinkClick(event)">dismiss</a>
    </div>
  </div>
  <div id="credits" class="full-page" style="display: none">
    <div class="modal-bg">
      <h1>Credits</h1>
      <ul>
        <li>
          Gameplay inspired by <a href="https://www.nytimes.com/puzzles/spelling-bee">Spelling Bee</a> published by the
          New York Times
        </li>
        <li>
          Word list from <a href="https://github.com/Shavian-info/readlex">the Read Lexicon</a>
        </li>
        <li>
          Programming by Haley Wakamatsu
        </li>
        <li>
          <a href="https://2gd4.me/shavian-fonts">Space Mono font</a> by Haley Wakamatsu (Latin portion from <a
            href="https://fonts.google.com/specimen/Space+Mono">â€œSpace Monoâ€ font</a>)
        </li>
        <li>
          SFX and voice samples by Haley Wakamatsu
        </li>
      </ul>
      <a href="#credits" onclick="onCloseLinkClick(event)">dismiss</a>
    </div>
  </div>
</body>

</html>